<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Money Tracker</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    body {
      margin: 0;
      padding: 24px;
      background: #fafafa;
      color: #222;
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.06);
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .tab {
      flex: 1;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    .tab.active {
      background: linear-gradient(135deg, #FFD89B, #FF9A8B);
      border: none;
    }
    input, select, textarea, button {
      width: 100%;
      margin-bottom: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 15px;
    }
    textarea { resize: none; }
    button {
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(135deg, #FFD89B, #FF9A8B);
    }
    .hidden { display: none; }
    .preview {
      background: #fff7ef;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.5;
      margin-top: 12px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Money Tracker</h1>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" id="tabDaily">Daily</button>
      <button class="tab" id="tabAdjustment">Adjustment</button>
    </div>

    <!-- ========== DAILY ========== -->
    <div id="dailyForm">
      <input id="notes" placeholder="Notes (e.g. Starbucks / CC payment / transfer)" />
      <input id="date" type="date" />

      <select id="type">
        <option value="Expense">Expense</option>
        <option value="Income">Income</option>
        <option value="Transfer">Transfer</option>
      </select>

      <select id="account">
        <option value="">Select account</option>
        <option>BoA</option>
        <option>Chase</option>
        <option>BoA Credit Card</option>
        <option>Chase Credit Card</option>
      </select>

      <!-- Transfer -->
      <div id="transferBlock" class="hidden">
        <select id="fromAccount">
          <option value="">From account</option>
          <option>BoA</option>
          <option>Chase</option>
          <option>BoA Credit Card</option>
          <option>Chase Credit Card</option>
        </select>
        <select id="toAccount">
          <option value="">To account</option>
          <option>BoA</option>
          <option>Chase</option>
          <option>BoA Credit Card</option>
          <option>Chase Credit Card</option>
        </select>
      </div>

      <!-- Category -->
      <select id="category"></select>
      <select id="subcategory" class="hidden"></select>

      <input id="amount" type="number" step="0.01" placeholder="Amount" />

      <button id="submit">Submit</button>

      <div id="preview" class="preview hidden"></div>
      <button id="confirm" class="hidden">Confirm</button>
    </div>

    <!-- ========== ADJUSTMENT ========== -->
    <div id="adjustmentForm" class="hidden">
      <input id="adjNotes" placeholder="Adjustment notes" />
      <input id="adjMonth" type="month" />
      <select id="adjAccount">
        <option value="">Select account</option>
        <option>BoA</option>
        <option>Chase</option>
        <option>BoA Credit Card</option>
        <option>Chase Credit Card</option>
      </select>
      <input id="adjAmount" type="number" step="0.01" placeholder="Adjustment amount" />
      <button id="adjSubmit">Submit Adjustment</button>
    </div>
  </div>

<script>
/* ================= CONFIG ================= */
const WEBHOOK_URL = "https://angeoosn.app.n8n.cloud/webhook/62656b27-714e-4c1c-a1cc-28e0bf0c7295";

/* ===== Category / Subcategory ===== */
const CATEGORY_MAP = {
  "Food": ["Dining", "Grocery"],
  "Travel": ["Flight", "Hotel", "Others"],
  "Subscription": [],
  "Daily Necessities": ["Rent"],
  "Transport": [],
  "Education": [],
  "Investment": [],
  "Entertainment": [],
  "Income": ["Deposit", "Dividend / Interest", "Refund / Gift"]
};

/* ===== Elements ===== */
const tabDaily = document.getElementById("tabDaily");
const tabAdjustment = document.getElementById("tabAdjustment");
const dailyForm = document.getElementById("dailyForm");
const adjustmentForm = document.getElementById("adjustmentForm");

const typeEl = document.getElementById("type");
const transferBlock = document.getElementById("transferBlock");

const categoryEl = document.getElementById("category");
const subcategoryEl = document.getElementById("subcategory");

const submitBtn = document.getElementById("submit");
const confirmBtn = document.getElementById("confirm");
const previewBox = document.getElementById("preview");

/* ===== Tabs ===== */
tabDaily.onclick = () => {
  tabDaily.classList.add("active");
  tabAdjustment.classList.remove("active");
  dailyForm.classList.remove("hidden");
  adjustmentForm.classList.add("hidden");
};
tabAdjustment.onclick = () => {
  tabAdjustment.classList.add("active");
  tabDaily.classList.remove("active");
  adjustmentForm.classList.remove("hidden");
  dailyForm.classList.add("hidden");
};

/* ===== Init category ===== */
categoryEl.innerHTML = '<option value="">Select category</option>';
Object.keys(CATEGORY_MAP).forEach(c => {
  const opt = document.createElement("option");
  opt.value = c;
  opt.textContent = c;
  categoryEl.appendChild(opt);
});

categoryEl.onchange = () => {
  const subs = CATEGORY_MAP[categoryEl.value] || [];
  if (subs.length === 0) {
    subcategoryEl.classList.add("hidden");
    subcategoryEl.innerHTML = "";
  } else {
    subcategoryEl.classList.remove("hidden");
    subcategoryEl.innerHTML = '<option value="">Select subcategory</option>';
    subs.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      subcategoryEl.appendChild(opt);
    });
  }
};

/* ===== Type logic ===== */
typeEl.onchange = () => {
  if (typeEl.value === "Transfer") {
    transferBlock.classList.remove("hidden");
    categoryEl.classList.add("hidden");
    subcategoryEl.classList.add("hidden");
  } else {
    transferBlock.classList.add("hidden");
    categoryEl.classList.remove("hidden");
  }
};

/* ===== Helpers ===== */
function buildPayload() {
  const type = typeEl.value;

  if (type === "Transfer") {
    return {
      transactionDate: document.getElementById("date").value,
      transactionType: "Transfer",
      fromAccount: document.getElementById("fromAccount").value,
      toAccount: document.getElementById("toAccount").value,
      amount: Number(document.getElementById("amount").value || 0),
      notes: document.getElementById("notes").value
    };
  }

  return {
    transactionDate: document.getElementById("date").value,
    transactionType: type,
    account: document.getElementById("account").value,
    category: categoryEl.value,
    subcategory: subcategoryEl.value || "",
    amount: Number(document.getElementById("amount").value || 0),
    notes: document.getElementById("notes").value
  };
}

function buildPreview(payload) {
  return `<pre>${JSON.stringify(payload, null, 2)}</pre>`;
}

/* ===== Submit (寬鬆版，一定會出 Confirm) ===== */
submitBtn.onclick = () => {
  const payload = buildPayload();
  previewBox.innerHTML = buildPreview(payload);
  previewBox.classList.remove("hidden");
  confirmBtn.classList.remove("hidden");
  confirmBtn.disabled = false;
};

/* ===== Confirm ===== */
confirmBtn.onclick = async () => {
  const payload = buildPayload();
  confirmBtn.disabled = true;
  confirmBtn.innerText = "Sending...";

  try {
    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    alert("Recorded ✅");
    location.reload();
  } catch (e) {
    alert("Failed ❌");
    confirmBtn.disabled = false;
    confirmBtn.innerText = "Confirm";
  }
};
</script>
</body>
</html>


